from sqlalchemy.orm import Session
from db import engine
from models.plan import Plan
from faker import Faker
import random
import os

# üß† Inicializa Faker para generar datos realistas en espa√±ol
fake = Faker("es_ES")

# üìÅ Ruta absoluta a la carpeta de im√°genes
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
CARPETA_IMAGENES = os.path.join(BASE_DIR, "uploads", "planes_img")
os.makedirs(CARPETA_IMAGENES, exist_ok=True)

# üñºÔ∏è Carga las im√°genes que ya existen en la carpeta
IMAGENES = [
    nombre for nombre in os.listdir(CARPETA_IMAGENES)
    if nombre.lower().endswith((".jpg", ".jpeg", ".png", ".webp"))
]

# ‚ö†Ô∏è Verificaci√≥n: si no hay im√°genes, se lanza un error
if not IMAGENES:
    raise Exception(f"‚ö†Ô∏è No se encontraron im√°genes en la carpeta: {CARPETA_IMAGENES}\n"
                    f"Por favor agrega algunas antes de ejecutar este script.")

def generar_planes(cantidad=50):
    """
    Genera 'cantidad' de registros aleatorios de planes tur√≠sticos
    y los inserta en la base de datos usando im√°genes existentes.
    """
    with Session(engine) as session:
        planes = []
        for _ in range(cantidad):
            nombre_imagen = random.choice(IMAGENES)

            plan = Plan(
                nombre=fake.unique.catch_phrase()[:30],
                descripcion=fake.text(max_nb_chars=180),
                descripcion_corta=fake.sentence(nb_words=5),
                costo_persona=random.randint(100000, 500000),
                imagen=nombre_imagen,  # ‚úÖ Se guarda solo el nombre del archivo
                id_ciudad=random.randint(1, 8),  # ajusta seg√∫n tus ciudades
                id_informe=None,
                id_Admin=1,
            )
            planes.append(plan)

        session.add_all(planes)
        session.commit()
        print(f"‚úÖ {cantidad} planes creados exitosamente usando im√°genes existentes.")


if __name__ == "__main__":
    generar_planes(20)  # Cambia la cantidad seg√∫n necesites
